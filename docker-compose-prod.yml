version: '3'

services: 
  ## Server
  server:
    build: ./server
    # depends_on: 
    #   - cert-provider
    # networks: 
    #   - frontend
    #   - backend
    expose: 
      - 8081
    ports:
      - 8081:8081
    volumes: 
      - ./server/src:/srv/server/src
      - certs:/etc/letsencrypt/live:ro
    command: yarn start 8081

  ## Cert-Provider
  cert-provider:
    image: certbot/certbot
    # stdin_open: true
    expose: 
      - 80
    ports:
      - 80:80
    volumes: 
      - certs:/etc/letsencrypt/live
    # entrypoint: /bin/sh
    # tty: true
    command: certonly --standalone

# networks: 
#   frontend:
#     internal: false
#   backend:
#     internal: true

volumes:
  certs: